<div class="container py-4" style="max-width:720px">
  <% other = (@conversation.user1_id == current_user.id) ? @conversation.user2 : @conversation.user1 %>
  <div class="d-flex align-items-center gap-2 mb-3">
    <%= user_avatar(other, size: 40) %>
    <h1 class="h5 m-0"><%= user_name(other) %></h1>
  </div>

  <div class="border rounded p-3 mb-3 bg-white" style="min-height: 320px;">
    <% @messages.each do |m| %>
      <div class="mb-2">
        <div class="<%= m.user_id == current_user.id ? 'text-end' : '' %>">
          <div class="small text-muted mb-1"><%= user_name(m.user) %></div>
          <div class="d-inline-block px-3 py-2 rounded <%= m.user_id == current_user.id ? 'bg-primary text-white' : 'bg-light' %>">
            <%= simple_format h(m.body) %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <%= form_with model: [@conversation, @message], local: true do |f| %>
    <div class="input-group">
      <%= f.text_area :body, rows: 2, class: "form-control", placeholder: "メッセージを入力…" %>
      <button class="btn btn-primary" type="submit">送信</button>
    </div>
  <% end %>
</div>

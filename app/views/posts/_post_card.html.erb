<!-- app/views/posts/_post_card.html.erb -->
<div class="card p-3">
  <div class="d-flex align-items-center gap-2 mb-2">
    <%= link_to nui_path(post.nui) do %>
      <%= avatar_for(post.nui, size: 40) %>
    <% end %>
    <div>
      <div class="fw-semibold"><%= link_to post.nui.name, nui_path(post.nui) %></div>
      <div class="text-muted small">
        <%= l(post.created_at, format: :short) rescue post.created_at.to_s(:short) %>
      </div>
    </div>
  </div>

  <% if post.post.present? %>
    <p class="mb-2"><%= simple_format(h(post.post)) %></p>
  <% end %>

  <% if post.image&.attached? %>
    <div class="mb-2">
      <%= image_tag post.image.variant(resize_to_limit: [600, 600]).processed,
                    class: "img-fluid rounded" %>
    </div>
  <% end %>

  <div class="d-flex align-items-center gap-3 small">
    <span>いいね: <%= post.likes.size %></span>
    <span>コメント: <%= post.comments.size %></span>

    <%= link_to "詳細", [post.nui, post], class: "ms-auto" %>

    <% if user_signed_in? %>
      <% liked = post.liked_users.exists?(current_user.id) %>
      <% if liked %>
        <%= button_to "いいね解除", [post.nui, post, :like],
                      method: :delete, class: "btn btn-sm btn-outline-secondary" %>
      <% else %>
        <%= button_to "いいね", [post.nui, post, :like],
                      method: :post, class: "btn btn-sm btn-outline-primary" %>
      <% end %>
    <% end %>
  </div>
</div>

<% unless user_signed_in? %>
  <div class="container py-5" style="max-width:640px">
    <div class="text-center mb-3">
      <%= image_tag "logo.PNG", alt: "Nuilife ロゴ", class: "img-fluid", style: "max-height:60px;" %>
    </div>
    <div class="d-grid gap-2">
      <%= link_to "新規登録", new_user_registration_path, class: "btn btn-primary", style: "width: 150px; margin: 0 auto;" %>
      <%= link_to "ログイン", new_user_session_path, class: "btn btn-outline-primary", style: "width: 150px; margin: 0 auto;" %>
    </div>
  </div>
<% else %>
  <div class="container py-4">
    <!-- タブ -->
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <%= link_to "みんなの投稿",
                    root_path(tab: "all"),
                    class: "nav-link #{'active' if @tab == 'all'}" %>
      </li>
      <li class="nav-item">
        <%= link_to "フォロー中のぬい",
                    root_path(tab: "following"),
                    class: "nav-link #{'active' if @tab == 'following'}" %>
      </li>
    </ul>

    <!-- タブ内容 -->
    <% if @tab == 'following' %>
      <% if @posts_following.any? %>
        <div class="vstack gap-3">
          <% @posts_following.each do |post| %>
            <%= render "posts/post_card", post: post %>
          <% end %>
        </div>
        <div class="mt-3">
            <%= paginate @posts_following, params: { tab: 'following' } %>
        </div> 
      <% else %>
        <p class="text-muted">フォロー中のぬいの投稿はまだありません。</p>
        <p class="mb-0">
          気になるぬいのプロフィールから「フォローする」を押してみましょう。
        </p>
      <% end %>
    <% else %> <!-- all -->
      <% if @posts_all.any? %>
        <div class="vstack gap-3">
          <% @posts_all.each do |post| %>
            <%= render "posts/post_card", post: post %>
          <% end %>
        </div>
        <div class="mt-3">
          <%= paginate @posts_all, params: { tab: 'all' } %>  <!-- ★タブ状態を維持 -->
        </div>
      <% else %>
        <p class="text-muted">まだ投稿がありません。</p>
      <% end %>
    <% end %>
  </div>
<% end %>

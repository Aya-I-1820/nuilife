<div class="container py-4">

  <!-- ヘッダー：アイコン + 名前 + プロフィール -->
  <div class="d-flex align-items-center gap-3 mb-3">
    <%= avatar_for(@nui, size: 128) %>
    <div>
      <h1 class="h3 m-0"><%= @nui.name %></h1>
      <% if @nui.profile.present? %>
        <p class="text-muted mb-0"><%= simple_format(@nui.profile) %></p>
      <% end %>
    </div>
  </div>

<div class="mb-2">
  フォロワー: <strong><%= @nui.respond_to?(:followers_count) ? @nui.followers_count : @nui.followers.count %></strong>
  <%= link_to "（一覧を見る）", followers_nui_path(@nui), class: "ms-2" %>
</div>


<% if user_signed_in? %>
  <% following = current_user.followed_nuis.exists?(@nui.id) %>
  <% if following %>
    <%= button_to "フォロー解除", [@nui, :follow], method: :delete,
                  class: "btn btn-outline-secondary btn-sm" %>
  <% else %>
    <%= button_to "フォローする",  [@nui, :follow], method: :post,
                  class: "btn btn-primary btn-sm" %>
  <% end %>
<% end %>

  <!-- オーナーのみ操作ボタン -->
  <% if user_signed_in? && @nui.user_id == current_user.id %>
    <div class="mb-4 d-flex gap-2">
      <%= link_to "このぬいで投稿する", new_nui_post_path(@nui), class: "btn btn-primary" %>
      <%= link_to "プロフィールを編集", edit_nui_path(@nui), class: "btn btn-outline-secondary" %>
      <%= link_to "ぬいを削除", nui_path(@nui),
                  data: { turbo_method: :delete, turbo_confirm: "削除しますか？" },
                  class: "btn btn-outline-danger" %>
    </div>
  <% end %>

  <hr>

  <!-- 投稿一覧 -->
  <h2 class="h5 mt-4 mb-3">このぬいの投稿</h2>

  <% if @posts.any? %>
    <div class="vstack gap-3">
      <% @posts.each do |post| %>
        <%= render "posts/post_card", post: post %>
      <% end %>
    </div>
  <% else %>
    <p class="text-muted">まだ投稿がありません。</p>
  <% end %>
</div>

